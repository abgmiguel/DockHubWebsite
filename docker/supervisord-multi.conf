[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:mongodb]
command=/usr/bin/mongod --dbpath /data/db --bind_ip 127.0.0.1
priority=1
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/mongodb.log
stderr_logfile=/var/log/supervisor/mongodb-error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=2
stderr_logfile_backups=2

[program:backend]
command=/app/backend/server
priority=2
autostart=true
autorestart=true
startretries=3
environment=
    MONGODB_URI="mongodb://127.0.0.1:27017",
    PORT="3001",
    MULTI_TENANT="true",
    SITES_CONFIG_PATH="/app/sites-config.json",
    JWT_SECRET="production-secret-key-change-this",
    CORS_ORIGIN="*",
    ALLOWED_DOMAINS="localhost,codersinflow.com,darkflows.com"
stdout_logfile=/var/log/supervisor/backend.log
stderr_logfile=/var/log/supervisor/backend-error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=2
stderr_logfile_backups=2

[program:codersinflow]
command=node /app/astro-server.js codersinflow.com
priority=3
autostart=true
autorestart=true
startretries=3
environment=
    NODE_ENV="production",
    SITE_NAME="codersinflow.com",
    PORT="4321",
    HOST="127.0.0.1",
    API_URL="http://127.0.0.1:3001",
    PUBLIC_API_URL="http://127.0.0.1:3001"
stdout_logfile=/var/log/supervisor/codersinflow.log
stderr_logfile=/var/log/supervisor/codersinflow-error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=2
stderr_logfile_backups=2

[program:darkflows]
command=node /app/astro-server.js darkflows.com
priority=3
autostart=true
autorestart=true
startretries=3
environment=
    NODE_ENV="production",
    SITE_NAME="darkflows.com",
    PORT="4322",
    HOST="127.0.0.1",
    API_URL="http://127.0.0.1:3001",
    PUBLIC_API_URL="http://127.0.0.1:3001"
stdout_logfile=/var/log/supervisor/darkflows.log
stderr_logfile=/var/log/supervisor/darkflows-error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=2
stderr_logfile_backups=2

[program:proxy]
command=node /app/proxy-server.js
priority=4
autostart=true
autorestart=true
startretries=3
environment=
    NODE_ENV="production",
    PORT="8000",
    API_URL="http://127.0.0.1:3001"
stdout_logfile=/var/log/supervisor/proxy.log
stderr_logfile=/var/log/supervisor/proxy-error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=2
stderr_logfile_backups=2

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface